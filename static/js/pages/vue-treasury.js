const app=new Vue({el:"#app",delimiters:["${","}"],vuetify:new Vuetify,pinia:Pinia.createPinia(),data(){return{income:{entries:[],debitAccounts:[],debitAccountsCopy:[],creditAccounts:[],creditAccountsCopy:[],currencies:[],currenciesCopy:[],partners:[],partnersCopy:[],statements:[],statementsCopy:[],headers:[{text:"Date de l'opération",align:"start",sortable:!0,value:"dateTransaction"},{text:"Compte",value:"account"},{text:"Libellé",value:"label"},{text:"Montant en devise",value:"amountForeign"},{text:"Debit",value:"debit"},{text:"Crédit",value:"credit",sortable:!1}],countDebitAccount:1,countCreditAccount:1,menu:!1,loading:!1,creditLoading:!1,debitLoading:!1,statementsLoading:!1,currencyOperationLoading:!1,isForeigncurrencyOperation:!1,partnerLoading:!1,dialog:!1,dialogDelete:!1,dialogEntry:!1,dialogIntern:!1,selectedStatement:0,search:"",searchCredit:"",searchDebit:"",searchPartner:"",searchCurrency:"",filter:{},sortDesc:!1,page:1,itemsPerPage:15,sortBy:"text",keys:["text","ref","number"],editedIndex:-1,editedItem:{id:"",creditAccount:[],debitAccount:[],partner:"",reference:"",label:"",currency:"",rate:"",amountDebit:[],amountCredit:[],dateOperation:""},defaultItem:{id:"",creditAccount:[],debitAccount:[],partner:"",reference:"",label:"",currency:"",rate:"",amountDebit:[],amountCredit:[],dateOperation:new Date(Date.now()-6e4*(new Date).getTimezoneOffset()).toISOString().substr(0,10)}},customer:{bills:[],billsCopy:[],selectedBill:[],headers:[{text:"Date de l'opération",align:"start",sortable:!0,value:"dateOperation"},{text:"Compte",value:"account"},{text:"Partenaire",value:"partner"},{text:"Libellé",value:"label"},{text:"Pièce comptable",value:"reference",sortable:!1},{text:"Montant en devises",value:"amountForeign"},{text:"Montant",value:"amount"}],loading:!1},test:[],minDate:"",maxDate:"",moduleId:"",moduleName:"",currentCurrency:"",currentMonth:"",currentYear:"",rules:{account:[e=>!!e||"Veuillez choisir un compte"],currency:[e=>!!e||"Veuillez choisir une devise"],rate:[e=>!!e||"Veuillez saisir un taux de change"],label:[e=>!!e||"Veuillez saisir un libellé"],slip:[e=>!!e||"Veuillez choisir un type pour la pièce justificative"],reference:[e=>!!e||"Veuillez saisir un numéro de bordereau"],amount:[e=>!!e||"Veuillez saisir un montant",e=>/^-?[0-9]\d*(\.\d+)?$/.test(e)||"Veuillez saisir un nombre"],date:[e=>!!e||"Veuillez choisir une date"]},tab:null,tabLettering:null,drawerHeight:"",snackbar:!1,multiLine:!1,moduleMenu:!1,snacktext:"",snackcolor:"",timeout:2e3}},watch:{options:{handler(){this.getDataIncomes()},deep:!0},income:{handler(e,t){e=e.entries.slice(1);Array.from(e).forEach(t=>{var e=this.customer.bills.findIndex(e=>e.id===t.id);-1<e&&(this.customer.bills[e].amountCalculated=this.customer.bills[e].amount-t.credit)})},deep:!0},dialogIncomes(e){e||this.close()},dialogIncomesDelete(e){e||this.closeDelete()},watchSelectedBill(e,t){let a=Array.from(e);e=Array.from(t);if(0===a.length)if(1===e.length){const i=this.income.entries[1];var t=this.customer.bills.findIndex(e=>e.id===i.id),t=(this.customer.bills[t].amountCalculated=this.customer.bills[t].amount,this.income.entries.splice(1,1),this.customer.headers.findIndex(e=>"amountCalculated"===e.value));this.customer.headers.splice(t,1)}else 1<e.length&&(e.forEach(t=>{var e=this.income.entries.findIndex(e=>e.id===t.id);if(0<e){const n=this.income.entries[e];var i=this.customer.bills.findIndex(e=>e.id===n.id);this.customer.bills[i].amountCalculated=this.customer.bills[i].amount,this.income.entries.splice(e,1)}}),t=this.customer.headers.findIndex(e=>"amountCalculated"===e.value),this.customer.headers.splice(t,1));else a.length<e.length&&1<=a.length&&e.forEach(t=>{if(!a.find(e=>e.id===t.id)){var e=this.income.entries.findIndex(e=>e.id===t.id);const n=this.income.entries[e];var i=this.customer.bills.findIndex(e=>e.id===n.id);this.customer.bills[i].amountCalculated=this.customer.bills[i].amount,this.income.entries.splice(e,1)}})}},methods:{capFirst(e){return e[0].toUpperCase()+e.slice(1)},incrementCountDebitAccountIncome(){this.countDebitAccountIncome+=1,this.income.editedItem.amountDebit.push(""),this.income.editedItem.debitAccount.push("")},decrementCountDebitAccountIncome(e){--this.income.countDebitAccount,this.income.editedItem.amountDebit.splice(e-1,1),this.income.editedItem.debitAccount.splice(e-1,1)},incrementCountCreditAccountIncome(){this.income.countCreditAccount+=1,this.income.editedItem.amountCredit.push(""),this.income.editedItem.creditAccount.push("")},decrementCountCreditAccountIncome(e){--this.income.countCreditAccount,this.income.editedItem.amountCredit.splice(e-1,1),this.income.editedItem.creditAccount.splice(e-1,1)},getUrlData(){var e=window.location.pathname.split("/");this.moduleName=e[2]},getModule(){this.apiCall("get","/api/settings/journal?type="+this.moduleName).then(e=>{e=e.data;this.moduleId=e.id,this.getStatements(),this.getDebitAccounts()})},getStatements(){this.income.statementsLoading=!0,this.apiCall("get","/api/treasury/statements/get?journal="+this.moduleId).then(e=>{e=e.data;let t=[];Array.from(e).forEach(e=>{t.push({id:e.id,dateTransaction:this.formatDate(e.transaction_at),reference:e.reference,label:e.label,currencyId:e.currency_id,currencySymbol:e.currency__symbol,currencyName:e.currency__name,accountId:e.account_id,accountNumber:e.account__account_number,accountName:e.account__account_name,amount:null!==e.amount?e.amount:"",rate:e.rate})}),this.income.statements=t,this.income.statementsCopy=[...this.income.statements],this.income.statementsLoading=!1}).catch(e=>{})},getCreditAccounts(){this.income.creditLoading=!0,this.apiCall("get","/api/accounting/plan/accounts-by-categories/get?categories=produit,passif").then(e=>{e=e.data;let t=[];0<e.length&&(Array.from(e).forEach(e=>{t.push({id:e.id,label:e.account_number+"  "+e.account_name})}),this.income.creditAccounts=t,this.income.creditCopy=[...this.income.creditAccounts],this.income.creditLoading=!1)})},getDebitAccounts(){this.income.debitLoading=!0,this.apiCall("get",`/api/accounting/journal/${this.moduleId}/get`).then(e=>{e=e.data;let t=[];0<e.length&&(Array.from(e).forEach(e=>{t.push({id:e.id,label:e.account_number+"  "+e.account_name})}),this.income.debitAccounts=t,this.income.editedItem.debitAccount=t[0].id,this.income.defaultItem.debitAccount=t[0].id,this.income.debitAccountsCopy=[...this.income.debitAccounts],this.income.debitLoading=!1)})},getPartners(){this.income.partnerLoading=!0,this.apiCall("get","/api/billing/partners/get").then(e=>{e=e.data;let t=[];0<e.length&&(Array.from(e).forEach(e=>{t.push({id:e.id,label:""+e.name})}),this.income.partners=t,this.income.partnersCopy=[...this.income.partners],this.income.partnerLoading=!1)})},savePartner(){var e;""===this.income.searchPartner?(this.snacktext="Veuillez saisir un nom avant de créer un partenaire",this.snackbar=!0,this.snackcolor="red darken-3"):(e={name:this.income.searchPartner},this.apiCall("post","/api/billing/partner/save",e).then(e=>{var t=e.data.partner,e=e.data.message;this.income.partnerloading=!1,this.snacktext=e,this.snackbar=!0,this.income.partnerLoading=!1,this.snackcolor="green darken-3",this.income.editedItem.partner=t,this.income.searchPartner="",this.income.partners.push(t),this.income.partnersCopy=this.income.partners}))},savePartnerAndEdit(){},getCurrency(){this.income.currencyOperationLoading=!0,this.apiCall("get","/api/treasury/currencies/get").then(e=>{e=e.data;let t=[];0<e.length&&(Array.from(e).forEach(e=>{e.is_local&&(this.income.editedItem.currency=e.id,this.income.defaultItem.currency=e.id),t.push({id:e.id,label:""+e.name,symbol:""+e.symbol,is_local:e.is_local,rate:e.rate})}),this.income.currencies=t,this.income.currenciesCopy=[...this.income.currencies],this.income.currencyOperationLoading=!1)})},getBills(){this.customer.loading=!0,this.apiCall("get","/api/billing/customer/bills/get?journal="+this.moduleId).then(e=>{e=e.data;let t=[];Array.from(e).forEach(e=>{t.push({id:e.id,dateOperation:this.formatDate(e.bill_at),account:e.account__account_number+" "+e.account__account_name,partner:e.partner__name,label:e.label,reference:e.reference,amountForeign:e.amount_foreign,amountForeignCalculated:e.amount_foreign,amount:e.amount,amountCalculated:e.amount})}),this.customer.bills=t,this.customer.billsCopy=[...this.customer.bills],this.customer.loading=!1})},searchIncomesCreditAccounts(e){this.income.searchCredit||(this.income.creditAccounts=this.income.creditCopy),this.income.creditAccounts=this.income.creditCopy.filter(e=>-1<e.label.toLowerCase().indexOf(this.income.searchCredit.toLowerCase()))},searchIncomesDebitAccounts(e){this.income.searchDebit||(this.income.debitAccounts=this.income.debitAccountsCopy),this.income.debitAccounts=this.income.debitAccountsCopy.filter(e=>-1<e.label.toLowerCase().indexOf(this.income.searchDebit.toLowerCase()))},searchIncomesPartners(e){this.income.searchPartner||(this.income.partners=this.income.partnersCopy),this.income.partners=this.income.partnersCopy.filter(e=>{if(null!=this.income.searchPartner)return-1<e.label.toLowerCase().indexOf(this.income.searchPartner.toLowerCase())})},searchIncomesCurrencies(e){this.income.searchCurrency||(this.income.currencies=this.income.currenciesCopy),this.income.currencies=this.income.currenciesCopy.filter(e=>{if(null!=this.income.searchCurrency)return-1<e.label.toLowerCase().indexOf(this.income.searchCurrency.toLowerCase())})},formatDate(e){var t,i;return e?([e,t,i]=e.split("-"),i+`/${t}/`+e):null},parseDate(e){var t,i;return e?([e,t,i]=e.split("/"),`${t.padStart(2,"0")}-${e.padStart(2,"0")}-`+i):null},setOperationDate(){var[,,,]=new Date(Date.now()-6e4*(new Date).getTimezoneOffset()).toISOString().substr(0,10).split("-")},apiCall(e,t,i){return"get"===e?axios.get(t):"post"===e?axios.post(t,i):void 0},editItem(e){this.income.editedIndex=this.income.entries.indexOf(e),this.income.editedItem=Object.assign({},e),this.income.dialog=!0},deleteItem(e){this.income.editedIndex=this.income.entries.indexOf(e),this.income.editedItem=Object.assign({},e),this.income.dialogDelete=!0},deleteItemConfirm(){var e=this.income.editedItem.id,e=(this.income.loading=!0,{id:e});this.apiCall("post","/api/accounting/main/delete",e).then(e=>{this.income.loading=!1,this.snacktext=e.data.message,this.snackbar=!0,this.snackcolor="green darken-3",this.income.entries.splice(this.income.editedIndex,1),this.income.dialogDelete=!1})},close(){this.income.dialog=!1,this.$nextTick(()=>{this.income.editedItem=Object.assign({},this.income.defaultItem),this.income.editedIndex=-1})},closeDelete(){this.income.dialogDelete=!1,this.$nextTick(()=>{this.income.editedItem=Object.assign({},this.income.defaultItem),this.income.editedIndex=-1})},closeDialogEntry(){this.income.dialogEntry=!1,this.$nextTick(()=>{this.income.editedItem={id:"",creditAccount:[],debitAccount:[],partner:"",reference:"",label:"",amountDebit:[],amountCredit:[],dateOperation:new Date(Date.now()-6e4*(new Date).getTimezoneOffset()).toISOString().substr(0,10)},this.income.editedItem.debitAccount[0]=this.income.defaultItem.debitAccount[0],this.income.editedIndex=-1,this.income.countDebitAccount=1,this.income.countCreditAccount=1})},setData(){return{id:this.income.editedItem.id,currency:this.income.editedItem.currency,rate:this.income.editedItem.rate,account:this.income.editedItem.debitAccount,dateOperation:this.income.editedItem.dateOperation,amount:this.income.editedItem.amountDebit,partner:this.income.editedItem.partner,reference:this.income.editedItem.reference,label:this.income.editedItem.label}},saveAndClose(){var e;-1<this.income.editedItem.editedIndex?(this.income.loading=!0,e=this.setData(),this.apiCall("post","api/treasury/",e).then(e=>{e=e.data.message;this.snacktext=e,this.snackcolor="green darken-3",this.snackbar=!0,this.income.editedItem.dialogEntry=!1,this.income.loading=!1,Object.assign(this.income.entries[this.income.editedIndex],this.income.editedItem),this.$nextTick(()=>{this.income.editedItem=Object.assign({},this.income.defaultItem),this.income.editedIndex=-1})}).catch(e=>{e=e.response.data.message;this.income.loading=!1,this.snacktext=e,this.snackbar=!0,this.snackcolor="red darken-3"})):(e=this.setData(),this.$refs.formIncome.validate()&&(this.income.loading=!0,this.apiCall("post","/api/treasury/statement/save",e).then(e=>{e=e.data.message;this.snacktext=e,this.snackcolor="green darken-3",this.income.dialogEntry=!1,this.snackbar=!0,this.income.loading=!1,this.$nextTick(()=>{this.income.editedItem=Object.assign({},this.income.defaultItem),this.income.editedIndex=-1})}).catch(e=>{e=e.response.data.message;this.income.loading=!1,this.snacktext=e,this.snackbar=!0,this.snackcolor="red darken-3"})))},saveAndContinue(){var e;-1<this.income.editedIndex?(this.income.loading=!0,e=this.setData(),this.apiCall("post","api/treasury/",e).then(e=>{e=e.data.message;this.snacktext=e,this.snackcolor="green darken-3",this.snackbar=!0,this.income.dialog=!1,this.income.loading=!1,Object.assign(this.income.entries[this.income.editedIndex],this.income.editedItem),this.$nextTick(()=>{this.income.editedItem=Object.assign({},this.income.defaultItem),this.income.editedIndex=-1})}).catch(e=>{e=e.response.data.message;this.income.loading=!1,this.snacktext=e,this.snackbar=!0,this.snackcolor="red darken-3",this.income.dialog=!1})):(e=this.setData(),this.$refs.formIncome.validate()&&(this.income.loading=!0,this.apiCall("post","/api/treasury/statement/save",e).then(e=>{e=e.data.message;this.snacktext=e,this.snackcolor="green darken-3",this.snackbar=!0,this.income.loading=!1,this.$nextTick(()=>{this.income.editedItem=Object.assign({},this.income.defaultItem),this.income.editedIndex=-1})}).catch(e=>{e=e.response.data.message;this.income.loading=!1,this.snacktext=e,this.snackbar=!0,this.snackcolor="red darken-3",this.income.dialog=!1})))},nextPage(){this.page+1<=this.numberOfPages&&(this.page+=1)},formerPage(){1<=this.page-1&&--this.page}},computed:{formTitle(){return-1===this.income.editedIndex?"Nouveau Compte":"Modifier Compte"},thousandSeparator(){},getAccountingEntries(){var e=this.income.selectedStatement,e=this.income.statements[e];void 0!==e&&this.apiCall("get","/api/treasury/incomes/get?statementId="+e.id).then(e=>{e=e.data;let t=[];Array.from(e).forEach(e=>{t.push({id:e.id,dateTransaction:this.formatDate(e.date_at),account:e.account__account_number+" "+e.account__account_name,label:e.label,amountForeign:null!==e.amount_foreign?e.amount_foreign:"",debit:null!==e.debit?e.debit:"",credit:"",is_verified:e.is_verified})}),this.income.entries=t,this.customer.selectedBill=[],this.income.loading=!1,this.getBills()})},getBillAccountingEntry(){Array.from(this.customer.selectedBill).forEach(t=>{const i=this.income.entries.find(e=>e.id===t.id);if(!i){var n=this.income.entries[0].debit;let e;n>t.amount?e=t.amount:n<t.amount&&(e=n);const i=this.customer.headers.find(e=>"amountCalculated"===e.value);i||this.customer.headers.push({text:"Reste à payer",align:"start",sortable:!0,value:"amountCalculated"}),this.income.entries.push({id:t.id,dateTransaction:t.dateOperation,account:""+t.account,label:t.label,debit:"",credit:null!==e?e:""})}}),1<this.income.entries.length&&Array.from(this.customer.selectedBill).forEach(e=>{})},watchSelectedBill(){return this.customer.selectedBill},watchIncomeEntry(){return this.income.entries.slice(1)},partnerPlaceholder(){return 0===this.income.partners.length?"Exemple: Remya Tshipamba":"Rechercher partenaire"},partnerLabel(){return 0===this.income.partners.length&&"Créer un partenaire"},symbolCurrency(){let t;return Array.from(this.income.currencies).forEach(e=>{e.id===this.income.editedItem.currency&&(t=e.symbol.toUpperCase(),e.is_local?(this.income.isForeigncurrencyOperation=!1,this.income.editedItem.rate=""):(this.income.isForeigncurrencyOperation=!0,this.income.editedItem.rate=e.rate))}),"Montant en "+t},computedDateIncomesFormatted(){return this.formatDate(this.income.editedItem.dateOperation)},numberOfPages(){return Math.ceil(this.items.length/this.itemsPerPage)},filteredKeys(){return this.keys.filter(e=>"Name"!==e)},...Pinia.mapState(currencyStore,["currency_asset"])},created(){this.getUrlData(),this.getCurrency(),this.getModule(),this.setOperationDate(),this.getCreditAccounts(),this.getPartners()},mounted(){}});