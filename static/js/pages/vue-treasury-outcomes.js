const app=new Vue({el:"#app",delimiters:["${","}"],vuetify:new Vuetify,pinia:Pinia.createPinia(),data(){return{incomes:[],outcomes:[],creditAccountsIncomes:[],creditAccountsOutcomes:[],debitAccountsIncomes:[],debitAccountsOutcomes:[],currenciesIncomes:[],countDebitAccountIncome:1,countCreditAccountIncome:1,creditIncomesCopy:[],creditOutcomesCopy:[],debitAccountsIncomesCopy:[],debitAccountsOutcomesCopy:[],typeDocuments:[],typeDocumentsCopy:[],headers:[{text:"Date de l'opération",align:"start",sortable:!0,value:"dateOperation"},{text:"Compte",value:"accountname"},{text:"Libellé",value:"accountslip"},{text:"Debit",value:"debit"},{text:"Crédit",value:"credit",sortable:!1}],rules:{account:[e=>!!e||"Veuillez choisir un compte"],currency:[e=>!!e||"Veuillez choisir une devise"],rate:[e=>!!e||"Veuillez saisir un taux de changz"],label:[e=>!!e||"Veuillez saisir un libellé"],slip:[e=>!!e||"Veuillez choisir un type pour la pièce justificative"],slipNumber:[e=>!!e||"Veuillez saisir un numéro de bordereau"],amount:[e=>!!e||"Veuillez saisir un montant",e=>/^-?[0-9]\d*(\.\d+)?$/.test(e)||"Veuillez saisir un nombre"],date:[e=>!!e||"Veuillez choisir une date"]},tab:null,drawerHeight:"",menuIncomes:!1,menuOutcomes:!1,loadingIncomes:!1,loadingOutcomes:!1,creditIncomesLoading:!1,creditOutcomesLoading:!1,debitIncomesLoading:!1,debitOutcomesLoading:!1,currencyOperationIncomeLoading:!1,isForeigncurrencyOperationIncome:!1,typeDocumentLoading:!1,dialogIncomes:!1,dialogOutcomes:!1,dialogIncomesDelete:!1,dialogOutcomesDelete:!1,dialogEntry:!1,dialogInternTrans:!1,snackbar:!1,multiLine:!1,moduleMenu:!1,selectedModule:1,items:[],search:"",filter:{},sortDesc:!1,page:1,itemsPerPage:15,sortBy:"text",keys:["text","ref","number"],snacktext:"",snackcolor:"",timeout:2e3,searchIncomes:"",searchOutcomes:"",searchIncomesCredit:"",searchOutcomesCredit:"",searchIncomesDebit:"",searchOutcomesDebit:"",searchIncomesSlip:"",options:{},editedIncomeIndex:-1,editedOutcomeIndex:-1,editedItemIncome:{id:"",creditAccount:[],debitAccount:[],slip:"",slipNumber:"",label:"",currency:"",rate:"",amountDebit:[],amountCredit:[],dateOperation:""},defaultItemIncomes:{id:"",creditAccount:[],debitAccount:[],slip:"",slipNumber:"",label:"",currency:"",rate:"",amountDebit:[],amountCredit:[],dateOperation:new Date(Date.now()-6e4*(new Date).getTimezoneOffset()).toISOString().substr(0,10)},editedItemOutcome:{id:"",creditAccount:[],debitAccount:[],slip:"",slipNumber:"",label:"",currency:"",rate:"",amountDebit:[],amountCredit:[],dateOperation:""},defaultItemOutcomes:{id:"",creditAccount:[],debitAccount:[],slip:"",slipNumber:"",label:"",currency:"",rate:"",amountDebit:[],amountCredit:[],dateOperation:new Date(Date.now()-6e4*(new Date).getTimezoneOffset()).toISOString().substr(0,10)},minDate:"",maxDate:"",moduleId:"",moduleName:"",currentCurrency:"",currentMonth:"",currentYear:""}},watch:{options:{handler(){this.getDataIncomes()},deep:!0},dialogIncomes(e){e||this.close()},dialogIncomesDelete(e){e||this.closeDelete()}},methods:{capFirst(e){return e[0].toUpperCase()+e.slice(1)},incrementCountDebitAccountIncome(){this.countDebitAccountIncome+=1,this.editedItemIncome.amountDebit.push(""),this.editedItemIncome.debitAccount.push("")},decrementCountDebitAccountIncome(e){--this.countDebitAccountIncome,this.editedItemIncome.amountDebit.splice(e-1,1),this.editedItemIncome.debitAccount.splice(e-1,1)},incrementCountCreditAccountIncome(){this.countCreditAccountIncome+=1,this.editedItemIncome.amountCredit.push(""),this.editedItemIncome.creditAccount.push("")},decrementCountCreditAccountIncome(e){--this.countCreditAccountIncome,this.editedItemIncome.amountCredit.splice(e-1,1),this.editedItemIncome.creditAccount.splice(e-1,1)},getUrlData(){var e=window.location.pathname.split("/");this.moduleName=e[2],this.moduleId=e[3],this.currentCurrency=e[4],this.currentMonth=e[5],this.currentYear=e[6]},getDataIncomes(){this.loading=!0;var e=this.currentCurrency,t=this.currentMonth;this.apiCall("get",`/api/treasury/incomes/${e}/${t}/get?year=`+this.currentYear).then(e=>{e=e.data;let t=[];Array.from(e).forEach(e=>{0<e.debit&&t.push({id:e.id,dateOperation:this.formatDate(e.date_at),accountname:e.account__account_number+" "+this.capFirst(e.account__account_name),accountslip:e.slip_number,debit:e.debit+" "+this.currentCurrency.toUpperCase()})}),this.incomes=t,this.loading=!1})},getCreditAccounts(){this.creditIncomesLoading=!0,this.apiCall("get","/api/accounting/plan/accounts-by-categories/get?categories=produit,passif").then(e=>{e=e.data;let t=[];0<e.length&&(Array.from(e).forEach(e=>{t.push({id:e.id,label:e.account_number+"  "+e.account_name})}),this.creditAccountsIncomes=t,this.creditIncomesCopy=[...this.creditAccountsIncomes],this.creditIncomesLoading=!1)})},getDebitAccounts(){this.debitIncomesLoading=!0,this.apiCall("get",`/api/accounting/plan/account/${this.moduleId}/get`).then(e=>{e=e.data;let t=[];0<e.length&&(Array.from(e).forEach(e=>{t.push({id:e.id,label:e.account_number+"  "+e.account_name})}),this.debitAccountsIncomes=t,this.editedItemIncome.debitAccount[0]=t[0].id,this.defaultItemIncomes.debitAccount[0]=t[0].id,this.debitAccountsIncomesCopy=[...this.debitAccountsIncomes],this.debitIncomesLoading=!1)})},getTypeDocuments(){this.typeDocumentLoading=!0,this.apiCall("get","/api/accounting/documents/type/get").then(e=>{e=e.data;let t=[];0<e.length&&(Array.from(e).forEach(e=>{t.push({id:e.id,label:""+e.name})}),this.typeDocuments=t,this.typeDocumentsCopy=[...this.typeDocuments],this.typeDocumentLoading=!1)})},getCurrency(){this.currencyOperationIncomeLoading=!0,this.apiCall("get","/api/treasury/currencies/get").then(e=>{e=e.data;let t=[];0<e.length&&(Array.from(e).forEach(e=>{e.is_local&&(this.editedItemIncome.currency=e.id,this.defaultItemIncomes.currency=e.id),t.push({id:e.id,label:""+e.name,symbol:""+e.symbol,is_local:e.is_local,rate:e.rate})}),this.currenciesIncomes=t,this.currencyOperationIncomeLoading=!1)})},searchIncomesCreditAccounts(e){this.searchIncomesCredit||(this.creditAccountsIncomes=this.creditIncomesCopy),this.creditAccountsIncomes=this.creditIncomesCopy.filter(e=>-1<e.label.toLowerCase().indexOf(this.searchIncomesCredit.toLowerCase()))},searchOutcomesCreditAccounts(e){this.searchIncomesCredit||(this.creditAccountsIncomes=this.creditIncomesCopy),this.creditAccountsIncomes=this.creditIncomesCopy.filter(e=>-1<e.label.toLowerCase().indexOf(this.searchIncomesCredit.toLowerCase()))},searchIncomesDebitAccounts(e){this.searchIncomesDebit||(this.debitAccountsIncomes=this.debitAccountsIncomesCopy),this.debitAccountsIncomes=this.debitAccountsIncomesCopy.filter(e=>-1<e.label.toLowerCase().indexOf(this.searchIncomesDebit.toLowerCase()))},searchIncomestypeDocuments(e){this.searchIncomesDebit||(this.typeDocuments=this.typeDocumentsCopy),this.typeDocuments=this.typeDocumentsCopy.filter(e=>-1<e.label.toLowerCase().indexOf(this.searchIncomesSlip.toLowerCase()))},searchOutcomesDebitAccounts(e){this.searchIncomesDebit||(this.debitAccountsIncomes=this.debitAccountsIncomesCopy),this.debitAccountsIncomes=this.debitAccountsIncomesCopy.filter(e=>-1<e.label.toLowerCase().indexOf(this.searchIncomesDebit.toLowerCase()))},formatDate(e){var t,i;return e?([e,t,i]=e.split("-"),i+`/${t}/`+e):null},parseDate(e){var t,i;return e?([e,t,i]=e.split("/"),`${t.padStart(2,"0")}-${e.padStart(2,"0")}-`+i):null},setOperationDate(){var e=new Date(Date.now()-6e4*(new Date).getTimezoneOffset()).toISOString().substr(0,10),[t,i,,]=e.split("-"),s=this.currentYear,n=1===(""+this.currentMonth).length?"0"+this.currentMonth:this.currentMonth;this.editedItemIncome.dateOperation=s===t&&n===i?e:s+`-${n}-01`,this.minDate=s+`-${n}-01`,this.maxDate=s+`-${n}-31`},apiCall(e,t,i){return"get"===e?axios.get(t):"post"===e?axios.post(t,i):void 0},editItem(e){this.editedIncomeIndex=this.incomes.indexOf(e),this.editedItemIncome=Object.assign({},e),this.dialogIncomes=!0},deleteItem(e){this.editedIncomeIndex=this.incomes.indexOf(e),this.editedItemIncome=Object.assign({},e),this.dialogIncomesDelete=!0},deleteItemConfirm(){var e=this.editedItemIncome.id,e=(this.loading=!0,{id:e});this.apiCall("post","/api/accounting/main/delete",e).then(e=>{this.loading=!1,this.snacktext=e.data.message,this.snackbar=!0,this.snackcolor="green darken-3",this.incomes.splice(this.editedIncomeIndex,1),this.dialogIncomesDelete=!1})},close(){this.dialogIncomes=!1,this.$nextTick(()=>{this.editedItemIncome=Object.assign({},this.defaultItemIncomes),this.editedIncomeIndex=-1})},closeDelete(){this.dialogIncomesDelete=!1,this.$nextTick(()=>{this.editedItemIncome=Object.assign({},this.defaultItemIncomes),this.editedIncomeIndex=-1})},closeDialogEntry(){this.dialogEntry=!1,this.$nextTick(()=>{this.editedItemIncome={id:"",creditAccount:[],debitAccount:[],slip:"",slipNumber:"",label:"",amountDebit:[],amountCredit:[],dateOperation:new Date(Date.now()-6e4*(new Date).getTimezoneOffset()).toISOString().substr(0,10)},this.editedItemIncome.debitAccount[0]=this.defaultItemIncomes.debitAccount[0],this.editedIncomeIndex=-1,this.countDebitAccountIncome=1,this.countCreditAccountIncome=1})},setData(){return{id:this.editedItemIncome.id,currency:this.editedItemIncome.currency,rate:this.editedItemIncome.rate,debit:this.editedItemIncome.debitAccount,credit:this.editedItemIncome.creditAccount,dateOperation:this.editedItemIncome.dateOperation,amountDebit:this.editedItemIncome.amountDebit,amountCredit:this.editedItemIncome.amountCredit,slip:this.editedItemIncome.slip,slipNumber:this.editedItemIncome.slipNumber,label:this.editedItemIncome.label}},saveAndClose(){if(-1<this.editedIncomeIndex){this.loading=!0;var e=this.setData();this.apiCall("post","api/treasury/",e).then(e=>{e=e.data.message;this.snacktext=e,this.snackcolor="green darken-3",this.snackbar=!0,this.dialogEntry=!1,this.loading=!1,Object.assign(this.incomes[this.editedIncomeIndex],this.editedItemIncome),this.$nextTick(()=>{this.editedItemIncome=Object.assign({},this.defaultItemIncomes),this.editedIncomeIndex=-1})}).catch(e=>{e=e.response.data.message;this.loading=!1,this.snacktext=e,this.snackbar=!0,this.snackcolor="red darken-3"})}else{e=this.setData();let t,i;Array.from(e.amountDebit).forEach(e=>{t+=e}),Array.from(e.amountCredit).forEach(e=>{i+=e}),t!==i&&(this.snacktext="Il n'y a pas d'équilibre entre le(s) compte(s) débités et le(s) compte(s) crédités",this.snackcolor="red darken-3",this.snackbar=!0),this.$refs.formIncome.validate()&&t===i&&(this.loading=!0,this.apiCall("post","/api/treasury/entry/save",e).then(e=>{e=e.data.message;this.snacktext=e,this.snackcolor="green darken-3",this.dialogEntry=!1,this.snackbar=!0,this.loading=!1,this.$nextTick(()=>{this.editedItemIncome=Object.assign({},this.defaultItemIncomes),this.editedIncomeIndex=-1})}).catch(e=>{e=e.response.data.message;this.loading=!1,this.snacktext=e,this.snackbar=!0,this.snackcolor="red darken-3"}))}},saveAndContinue(){if(-1<this.editedIncomeIndex){this.loading=!0;var e=this.setData();this.apiCall("post","api/treasury/",e).then(e=>{e=e.data.message;this.snacktext=e,this.snackcolor="green darken-3",this.snackbar=!0,this.dialogIncomes=!1,this.loading=!1,Object.assign(this.incomes[this.editedIncomeIndex],this.editedItemIncome),this.$nextTick(()=>{this.editedItemIncome=Object.assign({},this.defaultItemIncomes),this.editedIncomeIndex=-1})}).catch(e=>{e=e.response.data.message;this.loading=!1,this.snacktext=e,this.snackbar=!0,this.snackcolor="red darken-3",this.dialogIncomes=!1})}else{e=this.setData();let t,i;Array.from(e.amountDebit).forEach(e=>{t+=e}),Array.from(e.amountCredit).forEach(e=>{i+=e}),t!==i&&(this.snacktext="Il n'y a pas d'équilibre entre le compte débité et le(s) compte(s) crédités",this.snackcolor="red darken-3",this.snackbar=!0),this.$refs.formIncome.validate()&&t===i&&(this.loading=!0,this.apiCall("post","/api/treasury/entry/save",e).then(e=>{e=e.data.message;this.snacktext=e,this.snackcolor="green darken-3",this.snackbar=!0,this.loading=!1,this.$nextTick(()=>{this.editedItemIncome=Object.assign({},this.defaultItemIncomes),this.editedIncomeIndex=-1})}).catch(e=>{e=e.response.data.message;this.loading=!1,this.snacktext=e,this.snackbar=!0,this.snackcolor="red darken-3",this.dialogIncomes=!1}))}},nextPage(){this.page+1<=this.numberOfPages&&(this.page+=1)},formerPage(){1<=this.page-1&&--this.page}},computed:{formTitle(){return-1===this.editedIncomeIndex?"Nouveau Compte":"Modifier Compte"},symbolCurrency(){let t;return Array.from(this.currenciesIncomes).forEach(e=>{e.id===this.editedItemIncome.currency&&(t=e.symbol.toUpperCase(),e.is_local?(this.isForeigncurrencyOperationIncome=!1,this.editedItemIncome.rate=""):(this.isForeigncurrencyOperationIncome=!0,this.editedItemIncome.rate=e.rate))}),"Montant en "+t},computedDateIncomesFormatted(){return this.formatDate(this.editedItemIncome.dateOperation)},computedDateOutcomesFormatted(){return this.formatDate(this.editedItemOutcome.dateOperation)},drawerHeight(){return console.log(this.$el.clientHeight),.8*this.$el.clientHeight},numberOfPages(){return Math.ceil(this.items.length/this.itemsPerPage)},filteredKeys(){return this.keys.filter(e=>"Name"!==e)},...Pinia.mapState(currencyStore,["currency_asset"])},created(){this.getUrlData(),this.getCurrency(),this.setOperationDate(),this.getCreditAccounts(),this.getDebitAccounts(),this.getTypeDocuments(),this.getDataIncomes()},mounted(){for(let e=0;e<7e3;e++)this.items.push({text:"add "+e,ref:"ref "+e,number:"# "+e})}});