const app=new Vue({el:"#app",delimiters:["${","}"],vuetify:new Vuetify,pinia:Pinia.createPinia(),data(){return{income:{data:[],creditAccounts:[],debitAccounts:[],currencies:[],countDebitAccount:1,countCreditAccount:1,creditCopy:[],debitAccountsCopy:[],partners:[],partnersCopy:[],menu:!1,loading:!1,creditLoading:!1,debitLoading:!1,currencyOperationLoading:!1,isForeigncurrencyOperation:!1,partnerLoading:!1,dialog:!1,dialogDelete:!1,dialogEntry:!1,dialogIntern:!1,selectedModule:1,search:"",searchCredit:"",searchDebit:"",searchPartner:"",items:[],filter:{},sortDesc:!1,page:1,itemsPerPage:15,sortBy:"text",keys:["text","ref","number"],editedIndex:-1,editedItem:{id:"",creditAccount:[],debitAccount:[],partner:"",reference:"",label:"",currency:"",rate:"",amountDebit:[],amountCredit:[],dateOperation:""},defaultItem:{id:"",creditAccount:[],debitAccount:[],partner:"",reference:"",label:"",currency:"",rate:"",amountDebit:[],amountCredit:[],dateOperation:new Date(Date.now()-6e4*(new Date).getTimezoneOffset()).toISOString().substr(0,10)}},minDate:"",maxDate:"",moduleId:"",moduleName:"",currentCurrency:"",currentMonth:"",currentYear:""}},watch:{options:{handler(){this.getDataIncomes()},deep:!0},dialogIncomes(e){e||this.close()},dialogIncomesDelete(e){e||this.closeDelete()}},methods:{capFirst(e){return e[0].toUpperCase()+e.slice(1)},incrementCountDebitAccountIncome(){this.countDebitAccountIncome+=1,this.income.editedItem.amountDebit.push(""),this.income.editedItem.debitAccount.push("")},decrementCountDebitAccountIncome(e){--this.income.countDebitAccount,this.income.editedItem.amountDebit.splice(e-1,1),this.income.editedItem.debitAccount.splice(e-1,1)},incrementCountCreditAccountIncome(){this.income.countCreditAccount+=1,this.income.editedItem.amountCredit.push(""),this.income.editedItem.creditAccount.push("")},decrementCountCreditAccountIncome(e){--this.income.countCreditAccount,this.income.editedItem.amountCredit.splice(e-1,1),this.income.editedItem.creditAccount.splice(e-1,1)},getUrlData(){var e=window.location.pathname.split("/");this.moduleName=e[2],this.moduleId=e[3],this.currentCurrency=e[4],this.currentMonth=e[5],this.currentYear=e[6]},getDataIncomes(){this.income.loading=!0;var e=this.currentCurrency,t=this.currentMonth;this.apiCall("get",`/api/treasury/incomes/${e}/${t}/get?year=`+this.currentYear).then(e=>{e=e.data;let t=[];Array.from(e).forEach(e=>{0<e.debit&&t.push({id:e.id,dateOperation:this.formatDate(e.date_at),accountname:e.account__account_number+" "+this.capFirst(e.account__account_name),accountslip:e.slip_number,debit:e.debit+" "+this.currentCurrency.toUpperCase()})}),this.income.data=t,this.income.loading=!1})},getCreditAccounts(){this.income.creditLoading=!0,this.apiCall("get","/api/accounting/plan/accounts-by-categories/get?categories=produit,passif").then(e=>{e=e.data;let t=[];0<e.length&&(Array.from(e).forEach(e=>{t.push({id:e.id,label:e.account_number+"  "+e.account_name})}),this.income.creditAccounts=t,this.income.creditCopy=[...this.income.creditAccounts],this.income.creditLoading=!1)})},getDebitAccounts(){this.income.debitLoading=!0,this.apiCall("get",`/api/accounting/plan/account/${this.moduleId}/get`).then(e=>{e=e.data;let t=[];0<e.length&&(Array.from(e).forEach(e=>{t.push({id:e.id,label:e.account_number+"  "+e.account_name})}),this.income.debitAccounts=t,this.income.editedItem.debitAccount[0]=t[0].id,this.income.defaultItem.debitAccount[0]=t[0].id,this.income.debitAccountsCopy=[...this.income.debitAccounts],this.income.debitLoading=!1)})},getPartners(){this.income.partnerLoading=!0,this.apiCall("get","/api/accounting/documents/type/get").then(e=>{e=e.data;let t=[];0<e.length&&(Array.from(e).forEach(e=>{t.push({id:e.id,label:""+e.name})}),this.income.partners=t,this.income.partnersCopy=[...this.income.partners],this.income.partnerLoading=!1)})},getCurrency(){this.income.currencyOperationLoading=!0,this.apiCall("get","/api/treasury/currencies/get").then(e=>{e=e.data;let t=[];0<e.length&&(Array.from(e).forEach(e=>{e.is_local&&(this.income.editedItem.currency=e.id,this.income.defaultItem.currency=e.id),t.push({id:e.id,label:""+e.name,symbol:""+e.symbol,is_local:e.is_local,rate:e.rate})}),this.income.currencies=t,this.income.currencyOperationLoading=!1)})},searchIncomesCreditAccounts(e){this.income.searchCredit||(this.income.creditAccounts=this.income.creditCopy),this.income.creditAccounts=this.income.creditCopy.filter(e=>-1<e.label.toLowerCase().indexOf(this.income.searchCredit.toLowerCase()))},searchIncomesDebitAccounts(e){this.income.searchDebit||(this.income.debitAccounts=this.income.debitAccountsCopy),this.income.debitAccounts=this.income.debitAccountsCopy.filter(e=>-1<e.label.toLowerCase().indexOf(this.income.searchDebit.toLowerCase()))},searchIncomesPartners(e){this.income.searchPartner||(this.partners=this.partnersCopy),this.partners=this.partnersCopy.filter(e=>-1<e.label.toLowerCase().indexOf(this.income.searchPartner.toLowerCase()))},formatDate(e){var t,i;return e?([e,t,i]=e.split("-"),i+`/${t}/`+e):null},parseDate(e){var t,i;return e?([e,t,i]=e.split("/"),`${t.padStart(2,"0")}-${e.padStart(2,"0")}-`+i):null},setOperationDate(){var e=new Date(Date.now()-6e4*(new Date).getTimezoneOffset()).toISOString().substr(0,10),[t,i,,]=e.split("-"),n=this.currentYear,c=1===(""+this.currentMonth).length?"0"+this.currentMonth:this.currentMonth;this.income.editedItem.dateOperation=n===t&&c===i?e:n+`-${c}-01`,this.minDate=n+`-${c}-01`,this.maxDate=n+`-${c}-31`},apiCall(e,t,i){return"get"===e?axios.get(t):"post"===e?axios.post(t,i):void 0},editItem(e){this.income.editedIndex=this.income.data.indexOf(e),this.income.editedItem=Object.assign({},e),this.income.dialog=!0},deleteItem(e){this.income.editedIndex=this.income.data.indexOf(e),this.income.editedItem=Object.assign({},e),this.income.dialogDelete=!0},deleteItemConfirm(){var e=this.income.editedItem.id,e=(this.income.loading=!0,{id:e});this.apiCall("post","/api/accounting/main/delete",e).then(e=>{this.income.loading=!1,this.snacktext=e.data.message,this.snackbar=!0,this.snackcolor="green darken-3",this.income.data.splice(this.income.editedIndex,1),this.income.dialogDelete=!1})},close(){this.income.dialog=!1,this.$nextTick(()=>{this.income.editedItem=Object.assign({},this.income.defaultItem),this.income.editedIndex=-1})},closeDelete(){this.income.dialogDelete=!1,this.$nextTick(()=>{this.income.editedItem=Object.assign({},this.income.defaultItem),this.income.editedIndex=-1})},closeDialogEntry(){this.income.dialogEntry=!1,this.$nextTick(()=>{this.income.editedItem={id:"",creditAccount:[],debitAccount:[],partner:"",reference:"",label:"",amountDebit:[],amountCredit:[],dateOperation:new Date(Date.now()-6e4*(new Date).getTimezoneOffset()).toISOString().substr(0,10)},this.income.editedItem.debitAccount[0]=this.income.defaultItem.debitAccount[0],this.income.editedIndex=-1,this.income.countDebitAccount=1,this.income.countCreditAccount=1})},setData(){return{id:this.income.editedItem.id,currency:this.income.editedItem.currency,rate:this.income.editedItem.rate,debit:this.income.editedItem.debitAccount,credit:this.income.editedItem.creditAccount,dateOperation:this.income.editedItem.dateOperation,amountDebit:this.income.editedItem.amountDebit,amountCredit:this.income.editedItem.amountCredit,partner:this.income.editedItem.partner,reference:this.income.editedItem.reference,label:this.income.editedItem.label}},saveAndClose(){if(-1<this.editedItem.editedIndex){this.income.loading=!0;var e=this.setData();this.apiCall("post","api/treasury/",e).then(e=>{e=e.data.message;this.snacktext=e,this.snackcolor="green darken-3",this.snackbar=!0,this.income.editedItem.dialogEntry=!1,this.income.loading=!1,Object.assign(this.income.data[this.income.editedIndex],this.income.editedItem),this.$nextTick(()=>{this.income.editedItem=Object.assign({},this.income.defaultItem),this.income.editedIndex=-1})}).catch(e=>{e=e.response.data.message;this.income.loading=!1,this.snacktext=e,this.snackbar=!0,this.snackcolor="red darken-3"})}else{e=this.setData();let t,i;Array.from(e.amountDebit).forEach(e=>{t+=e}),Array.from(e.amountCredit).forEach(e=>{i+=e}),t!==i&&(this.snacktext="Il n'y a pas d'équilibre entre le(s) compte(s) débités et le(s) compte(s) crédités",this.snackcolor="red darken-3",this.snackbar=!0),this.$refs.formIncome.validate()&&t===i&&(this.income.loading=!0,this.apiCall("post","/api/treasury/entry/save",e).then(e=>{e=e.data.message;this.snacktext=e,this.snackcolor="green darken-3",this.income.dialogEntry=!1,this.snackbar=!0,this.income.loading=!1,this.$nextTick(()=>{this.income.editedItem=Object.assign({},this.income.defaultItem),this.income.editedIndex=-1})}).catch(e=>{e=e.response.data.message;this.income.loading=!1,this.snacktext=e,this.snackbar=!0,this.snackcolor="red darken-3"}))}},saveAndContinue(){if(-1<this.income.editedIndex){this.income.loading=!0;var e=this.setData();this.apiCall("post","api/treasury/",e).then(e=>{e=e.data.message;this.snacktext=e,this.snackcolor="green darken-3",this.snackbar=!0,this.income.dialog=!1,this.income.loading=!1,Object.assign(this.income.data[this.income.editedIndex],this.income.editedItem),this.$nextTick(()=>{this.income.editedItem=Object.assign({},this.income.defaultItem),this.income.editedIndex=-1})}).catch(e=>{e=e.response.data.message;this.income.loading=!1,this.snacktext=e,this.snackbar=!0,this.snackcolor="red darken-3",this.income.dialog=!1})}else{e=this.setData();let t,i;Array.from(e.amountDebit).forEach(e=>{t+=e}),Array.from(e.amountCredit).forEach(e=>{i+=e}),t!==i&&(this.snacktext="Il n'y a pas d'équilibre entre le compte débité et le(s) compte(s) crédités",this.snackcolor="red darken-3",this.snackbar=!0),this.$refs.formIncome.validate()&&t===i&&(this.income.loading=!0,this.apiCall("post","/api/treasury/entry/save",e).then(e=>{e=e.data.message;this.snacktext=e,this.snackcolor="green darken-3",this.snackbar=!0,this.income.loading=!1,this.$nextTick(()=>{this.income.editedItem=Object.assign({},this.income.defaultItem),this.income.editedIndex=-1})}).catch(e=>{e=e.response.data.message;this.income.loading=!1,this.snacktext=e,this.snackbar=!0,this.snackcolor="red darken-3",this.income.dialog=!1}))}},nextPage(){this.page+1<=this.numberOfPages&&(this.page+=1)},formerPage(){1<=this.page-1&&--this.page}},computed:{formTitle(){return-1===this.income.editedIndex?"Nouveau Compte":"Modifier Compte"},symbolCurrency(){let t;return Array.from(this.income.currencies).forEach(e=>{e.id===this.income.editedItem.currency&&(t=e.symbol.toUpperCase(),e.is_local?(this.income.isForeigncurrencyOperation=!1,this.income.editedItem.rate=""):(this.income.isForeigncurrencyOperation=!0,this.income.editedItem.rate=e.rate))}),"Montant en "+t},computedDateIncomesFormatted(){return this.formatDate(this.income.editedItem.dateOperation)},numberOfPages(){return Math.ceil(this.items.length/this.itemsPerPage)},filteredKeys(){return this.keys.filter(e=>"Name"!==e)},...Pinia.mapState(currencyStore,["currency_asset"])},created(){this.getUrlData(),this.getCurrency(),this.setOperationDate(),this.getCreditAccounts(),this.getDebitAccounts(),this.getPartners(),this.getDataIncomes()},mounted(){for(let e=0;e<7e3;e++)this.items.push({text:"add "+e,ref:"ref "+e,number:"# "+e})}});